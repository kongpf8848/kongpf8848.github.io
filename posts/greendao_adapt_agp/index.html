<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>greenDAO适配AGP 8.0+版本🚀</title><meta name=description content="本文介绍如何适配greenDAO以使用最新的Android Gradle Plugin 8.0+版本."><meta name=keywords content="blog,kongpf,hugo,greenDAO,gradle,android"><meta property="og:url" content="https://kongpf8848.github.io/posts/greendao_adapt_agp/"><meta property="og:type" content="website"><meta property="og:title" content="greenDAO适配AGP 8.0+版本🚀"><meta property="og:description" content="本文介绍如何适配greenDAO以使用最新的Android Gradle Plugin 8.0+版本."><meta property="og:image" content="https://kongpf8848.github.io/images/avatar.webp"><meta property="og:image:secure_url" content="https://kongpf8848.github.io/images/avatar.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="greenDAO适配AGP 8.0+版本🚀"><meta name=twitter:description content="本文介绍如何适配greenDAO以使用最新的Android Gradle Plugin 8.0+版本."><meta property="twitter:domain" content="https://kongpf8848.github.io/posts/greendao_adapt_agp/"><meta property="twitter:url" content="https://kongpf8848.github.io/posts/greendao_adapt_agp/"><meta name=twitter:image content="https://kongpf8848.github.io/images/avatar.webp"><link rel=canonical href=https://kongpf8848.github.io/posts/greendao_adapt_agp/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.edd985581bf860dfb4507e5885197f1680160c7fe19f23b31e183126d99dd596.js integrity="sha256-7dmFWBv4YN+0UH5YhRl/FoAWDH/hnyOzHhgxJtmd1ZY="></script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://kongpf8848.github.io/><img src=https://kongpf8848.github.io//images/avatar.webp alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://kongpf8848.github.io/>小飞的博客</a></div><div class=nav-links><div class=nav-link><a href=https://kongpf8848.github.io/posts/><span data-feather=file-text></span> 文章</a></div><div class=nav-link><a href=https://kongpf8848.github.io/tags/><span data-feather=tag></span> 标签</a></div><div class=nav-link><a href=https://github.com/kongpf8848><span data-feather=github></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://kongpf8848.github.io/posts/><span data-feather=file-text></span> 文章</a></li><li class=nav-item><a href=https://kongpf8848.github.io/tags/><span data-feather=tag></span> 标签</a></li><li class=nav-item><a href=https://github.com/kongpf8848><span data-feather=github></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>greenDAO适配AGP 8.0+版本🚀</h1><small role=doc-subtitle>本文介绍如何适配greenDAO以使用最新的Android Gradle Plugin 8.0+版本.</small><p class=post-date>July 16, 2023</p><ul class=post-tags><li class=post-tag><a href=https://kongpf8848.github.io/tags/greendao>greenDAO</a></li><li class=post-tag><a href=https://kongpf8848.github.io/tags/gradle>gradle</a></li><li class=post-tag><a href=https://kongpf8848.github.io/tags/android>android</a></li></ul></div><div class=post-content><p><p><a href=https://imgse.com/i/pCIP7cQ><img src=https://s1.ax1x.com/2023/07/16/pCIP7cQ.png alt=scene.png></a></p><h1 id=前言>前言</h1><p>在做的一个<a href=https://kotlinlang.org/>Kotlin</a>项目用到的数据库框架是<a href=https://github.com/greenrobot/greenDAO>greenDAO</a>，在将项目升级到AGP 8.0版本后，编译时由于greenDAO版本不兼容导致编译不过，经过一番摸索，最终解决了greenDAO在AGP 8.0+版本下的编译报错问题，特此记录一下😄</p><h1 id=环境>环境</h1><table><thead><tr><th style=text-align:center>名称</th><th style=text-align:center>版本</th></tr></thead><tbody><tr><td style=text-align:center>Android Studio</td><td style=text-align:center><code>Flamingo，2022.2.1 Patch 2</code></td></tr><tr><td style=text-align:center>JDK</td><td style=text-align:center><code>17.0.6</code></td></tr><tr><td style=text-align:center>Gradle</td><td style=text-align:center><code>8.0.2</code></td></tr><tr><td style=text-align:center>Android Gradle Plugin</td><td style=text-align:center><code>8.0.2</code></td></tr><tr><td style=text-align:center>targetSdkVersion</td><td style=text-align:center><code>33</code></td></tr></tbody></table><h1 id=升级greendao插件版本到331>升级greenDAO插件版本到3.3.1</h1><p>修改项目根目录下的<code>build.gradle</code>文件，内容如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>buildscript <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    repositories <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        google<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>        mavenCentral<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    dependencies <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        classpath <span style=color:#e6db74>&#39;com.android.tools.build:gradle:8.0.2&#39;</span>
</span></span><span style=display:flex><span>        classpath <span style=color:#e6db74>&#39;org.greenrobot:greendao-gradle-plugin:3.3.1&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h1 id=升级greendao依赖版本到330>升级greenDAO依赖版本到3.3.0</h1><p>修改项目模块如app模块下的<code>build.gradle</code>文件，内容如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>plugins <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#39;com.android.application&#39;</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#39;kotlin-android&#39;</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#39;kotlin-android-extensions&#39;</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#39;kotlin-kapt&#39;</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#39;org.greenrobot.greendao&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>greendao <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    schemaVersion <span style=color:#ae81ff>19</span>
</span></span><span style=display:flex><span>    daoPackage <span style=color:#e6db74>&#39;xxx&#39;</span>
</span></span><span style=display:flex><span>    targetGenDir <span style=color:#e6db74>&#39;src/main/java&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dependencies <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    implementation <span style=color:#e6db74>&#39;org.greenrobot:greendao:3.3.0&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>然后编译，还是编译不过，报错内容如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>org.gradle.internal.execution.WorkValidationException: Some problems were found with the configuration of task <span style=color:#e6db74>&#39;:app:greendao&#39;</span> <span style=color:#f92672>(</span>type <span style=color:#e6db74>&#39;DefaultTask&#39;</span><span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>  - Gradle detected a problem with the following location: <span style=color:#e6db74>&#39;/Users/kongpf/Desktop/mail-android/app/src/main/java&#39;</span>.
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    Reason: Task <span style=color:#e6db74>&#39;:app:compileOfficialDebugKotlin&#39;</span> uses this output of task <span style=color:#e6db74>&#39;:app:greendao&#39;</span> without declaring an explicit or implicit dependency. This can lead to incorrect results being produced, depending on what order the tasks are executed.
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    Possible solutions:
</span></span><span style=display:flex><span>      1. Declare task <span style=color:#e6db74>&#39;:app:greendao&#39;</span> as an input of <span style=color:#e6db74>&#39;:app:compileOfficialDebugKotlin&#39;</span>.
</span></span><span style=display:flex><span>      2. Declare an explicit dependency on <span style=color:#e6db74>&#39;:app:greendao&#39;</span> from <span style=color:#e6db74>&#39;:app:compileOfficialDebugKotlin&#39;</span> using Task#dependsOn.
</span></span><span style=display:flex><span>      3. Declare an explicit dependency on <span style=color:#e6db74>&#39;:app:greendao&#39;</span> from <span style=color:#e6db74>&#39;:app:compileOfficialDebugKotlin&#39;</span> using Task#mustRunAfter.
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    Please refer to https://docs.gradle.org/8.0.2/userguide/validation_problems.html#implicit_dependency <span style=color:#66d9ef>for</span> more details about this problem.
</span></span></code></pre></div><p>翻译一下，报错的意思就是<strong>任务&rsquo;:app:compileOfficialDebugKotlin&rsquo;使用任务&rsquo;:app:greendao&rsquo;的输出，但没有声明显式或隐式依赖，并贴心的给出了几种解决办法和相关的gradle<a href=https://docs.gradle.org/8.0.2/userguide/validation_problems.html#implicit_dependency>链接</a>.</strong></p><p>修改一下build.gradle脚本，添加依赖关系，编译kotlin的任务依赖greendao任务，如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>tasks<span style=color:#f92672>.</span><span style=color:#a6e22e>whenTaskAdded</span> <span style=color:#f92672>{</span> task <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>task<span style=color:#f92672>.</span><span style=color:#a6e22e>name</span><span style=color:#f92672>.</span><span style=color:#a6e22e>matches</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;compile\w*Kotlin&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        task<span style=color:#f92672>.</span><span style=color:#a6e22e>dependsOn</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;greendao&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>然后再重新编译就可以编译通过✅了，最终的build.gradle脚本如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>plugins <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#39;com.android.application&#39;</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#39;kotlin-android&#39;</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#39;kotlin-android-extensions&#39;</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#39;kotlin-kapt&#39;</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#39;org.greenrobot.greendao&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>greendao <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    schemaVersion <span style=color:#ae81ff>19</span>
</span></span><span style=display:flex><span>    daoPackage <span style=color:#e6db74>&#39;xxx&#39;</span>
</span></span><span style=display:flex><span>    targetGenDir <span style=color:#e6db74>&#39;src/main/java&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//添加依赖关系
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>tasks<span style=color:#f92672>.</span><span style=color:#a6e22e>whenTaskAdded</span> <span style=color:#f92672>{</span> task <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>task<span style=color:#f92672>.</span><span style=color:#a6e22e>name</span><span style=color:#f92672>.</span><span style=color:#a6e22e>matches</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;compile\w*Kotlin&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        task<span style=color:#f92672>.</span><span style=color:#a6e22e>dependsOn</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;greendao&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dependencies <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    implementation <span style=color:#e6db74>&#39;org.greenrobot:greendao:3.3.0&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h1 id=参考资源>参考资源</h1><ul><li><p><a href=https://github.com/greenrobot/greenDAO>https://github.com/greenrobot/greenDAO</a></p></li><li><p><a href=https://github.com/greenrobot/greenDAO/issues/1110># The project encountered errors after updating Gradle Version 7.6.1 to Gradle Version 8.0+</a></p></li><li><p><a href=https://docs.gradle.org/8.0.2/userguide/validation_problems.html#implicit_dependency>https://docs.gradle.org/8.0.2/userguide/validation_problems.html#implicit_dependency</a></p></li></ul></p></div><div class=prev-next><div class=next-post><p><a href=/posts/markdown-syntax/>:
Markdown Syntax Guide
&#8594;</a></p><p class=next-post-date>June 19, 2019</p></div></div></div></main><footer class=footer><span>&copy; 2023 kongpf8848</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/526avijitgupta/gokarna>Gokarna</a></span></footer></body></html>